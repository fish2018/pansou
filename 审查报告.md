# Goä»£ç å®¡æŸ¥æŠ¥å‘Š

**é¡¹ç›®**: pansou
**å®¡æŸ¥æ—¥æœŸ**: 2025-12-06
**å®¡æŸ¥èŒƒå›´**: æ‰€æœ‰Goè¯­è¨€ä»£ç 
**ä»£ç æ€»é‡**: 100+ æ–‡ä»¶

---

## ä¸€ã€å¤šä½™ä»£ç ã€å†—ä½™ä»£ç ã€é‡å¤ä»£ç 

### ğŸ”´ ä¸¥é‡é—®é¢˜

#### 1. æ’ä»¶ä»£ç é«˜åº¦é‡å¤ (ä¸¥é‡)

**ä½ç½®**: `plugin/yiove/`, `plugin/lou1/`, `plugin/mizixing/` ç­‰å¤šä¸ªæ’ä»¶

**é—®é¢˜æè¿°**:
å¤šä¸ªæ’ä»¶æ–‡ä»¶åŒ…å«å‡ ä¹å®Œå…¨ç›¸åŒçš„ä»£ç ,ä»£ç é‡å¤ç‡è¶…è¿‡60%:

##### 1.1 ç›¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
```go
// plugin/yiove/yiove.go:38-51
// plugin/lou1/lou1.go:37-50
// plugin/mizixing/mizixing.go:38-51
var (
    linkPatterns = []struct {
        reg *regexp.Regexp
        typ string
    }{
        {regexp.MustCompile(`https?://pan\.quark\.cn/(?:s|g)/[0-9A-Za-z]+`), "quark"},
        {regexp.MustCompile(`https?://pan\.baidu\.com/s/[0-9A-Za-z\-_?=&]+`), "baidu"},
        // ... å…¶ä»–10å¤šä¸ªå®Œå…¨ç›¸åŒçš„æ¨¡å¼
    }

    passwordPatterns = []*regexp.Regexp{
        regexp.MustCompile(`æå–ç [:ï¼š]?\s*([0-9A-Za-z]+)`),
        regexp.MustCompile(`å¯†ç [:ï¼š]?\s*([0-9A-Za-z]+)`),
        // ... å®Œå…¨ç›¸åŒ
    }
)
```

##### 1.2 ç›¸åŒçš„HTTPé…ç½®å¸¸é‡
```go
// åœ¨æ‰€æœ‰ä¸‰ä¸ªæ’ä»¶ä¸­å®Œå…¨ç›¸åŒ
const (
    requestTimeout      = 12 * time.Second
    detailTimeout       = 12 * time.Second
    maxRequestRetries   = 3
    retryBaseDelay      = 200 * time.Millisecond
    httpMaxIdleConns    = 64
    httpMaxIdlePerHost  = 16
    httpMaxConnsPerHost = 32
)
```

##### 1.3 ç›¸åŒçš„å·¥å…·å‡½æ•° (100å¤šè¡Œé‡å¤)
ä»¥ä¸‹å‡½æ•°åœ¨ä¸‰ä¸ªæ’ä»¶ä¸­å®Œå…¨ç›¸åŒ:
- `classifyLink()` - é“¾æ¥åˆ†ç±»
- `extractPassword()` - æå–å¯†ç 
- `matchPassword()` - åŒ¹é…å¯†ç 
- `newHTTPClient()` - åˆ›å»ºHTTPå®¢æˆ·ç«¯
- `setHTMLHeaders()` - è®¾ç½®HTTPè¯·æ±‚å¤´
- `doRequestWithRetry()` - é‡è¯•è¯·æ±‚
- `substring()` - å­—ç¬¦ä¸²æˆªå–
- `mergeTags()` - åˆå¹¶æ ‡ç­¾
- `buildUniqueID()` - ç”Ÿæˆå”¯ä¸€ID

**å½±å“**:
- ç»´æŠ¤æˆæœ¬é«˜: ä¿®æ”¹ä¸€å¤„éœ€è¦åŒæ­¥ä¿®æ”¹æ‰€æœ‰æ’ä»¶
- ä»£ç å†—ä½™: ä¼°è®¡æœ‰3000+è¡Œé‡å¤ä»£ç 
- æ½œåœ¨bug: ä¸åŒæ’ä»¶å¯èƒ½å‡ºç°ä¸ä¸€è‡´

**å»ºè®®**:
1. åˆ›å»º `util/plugin_common.go` ç»Ÿä¸€ç®¡ç†å…¬å…±ä»£ç 
2. åˆ›å»º `util/link_patterns.go` ç»Ÿä¸€ç®¡ç†æ­£åˆ™è¡¨è¾¾å¼
3. åˆ›å»º `util/http_helper.go` ç»Ÿä¸€ç®¡ç†HTTPå·¥å…·
4. æ’ä»¶åªä¿ç•™ç‰¹å®šé€»è¾‘

**é¢„æœŸæ”¶ç›Š**: å‡å°‘çº¦3000è¡Œé‡å¤ä»£ç 

---

#### 2. main.goä¸­çš„æ‰‹åŠ¨æ’ä»¶å¯¼å…¥ (ä¸­ç­‰)

**ä½ç½®**: `main.go:26-102`

**é—®é¢˜æè¿°**:
100å¤šè¡Œæ‰‹åŠ¨å¯¼å…¥è¯­å¥,ç»´æŠ¤å›°éš¾:

```go
// main.go:26-102
_ "pansou/plugin/hdr4k"
_ "pansou/plugin/gying"
_ "pansou/plugin/pan666"
// ... å…±75ä¸ªæ‰‹åŠ¨å¯¼å…¥
_ "pansou/plugin/yiove"
```

**å½±å“**:
- æ·»åŠ æ–°æ’ä»¶éœ€æ‰‹åŠ¨ä¿®æ”¹main.go
- å®¹æ˜“é—æ¼æˆ–é‡å¤å¯¼å…¥
- ä»£ç å†—é•¿,å¯è¯»æ€§å·®

**å»ºè®®**:
1. ä½¿ç”¨æ’ä»¶è‡ªåŠ¨æ³¨å†Œæœºåˆ¶
2. åˆ©ç”¨Goçš„init()å‡½æ•°è‡ªåŠ¨æ³¨å†Œ
3. æˆ–ä½¿ç”¨åå°„åŠ¨æ€åŠ è½½æ’ä»¶

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```go
// æ–¹æ¡ˆ1: ç»Ÿä¸€å¯¼å…¥ (æ¨è)
import (
    _ "pansou/plugin/all" // åœ¨all.goä¸­ç»Ÿä¸€å¯¼å…¥æ‰€æœ‰æ’ä»¶
)

// æ–¹æ¡ˆ2: ä½¿ç”¨æ’ä»¶ç›®å½•æ‰«æ (æ›´çµæ´»)
func loadPlugins() {
    // æ‰«æpluginç›®å½•,è‡ªåŠ¨åŠ è½½
}
```

---

#### 3. æ—¥å¿—è¾“å‡ºé€»è¾‘é‡å¤

**ä½ç½®**: `service/search_service.go`, `plugin/plugin.go`

**é—®é¢˜æè¿°**:
å¤šå¤„é‡å¤çš„æ—¥å¿—è¾“å‡ºåˆ¤æ–­é€»è¾‘:

```go
// service/search_service.go:64-67
if config.AppConfig == nil || !config.AppConfig.AsyncLogEnabled {
    return
}

// ç±»ä¼¼ä»£ç åœ¨å¤šå¤„é‡å¤å‡ºç°
```

**å»ºè®®**:
å°è£…ä¸ºç»Ÿä¸€çš„æ—¥å¿—å·¥å…·å‡½æ•°

---

### ğŸŸ¡ ä¸€èˆ¬é—®é¢˜

#### 4. ç¼“å­˜åºåˆ—åŒ–/ååºåˆ—åŒ–é€»è¾‘é‡å¤

**ä½ç½®**: `service/search_service.go` å¤šå¤„

**é—®é¢˜**: åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç æ¨¡å¼ç›¸åŒ,å¯ä»¥å°è£…

---

## äºŒã€é”™è¯¯ä»£ç ã€æ˜¾æ€§é”™è¯¯ã€éšæ€§é”™è¯¯

### ğŸ”´ ä¸¥é‡é—®é¢˜

#### 1. config.goä¸­çš„é”™è¯¯ä»£ç  (æ˜¾æ€§é”™è¯¯)

**ä½ç½®**: `config/config.go:577-586`

**é—®é¢˜ä»£ç **:
```go
func getAuthJWTSecret() string {
    secret := os.Getenv("AUTH_JWT_SECRET")
    if secret == "" {
        // ç”Ÿæˆéšæœºå¯†é’¥ï¼ˆ32å­—èŠ‚ï¼‰
        import_crypto := "crypto/rand"      // âŒ é”™è¯¯!
        import_encoding := "encoding/base64" // âŒ é”™è¯¯!
        _ = import_crypto
        _ = import_encoding
        // æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶åº”è¯¥ä½¿ç”¨crypto/randç”Ÿæˆéšæœºå¯†é’¥
        // è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºä¸´æ—¶å¯†é’¥
        secret = "pansou-default-secret-" + strconv.FormatInt(time.Now().Unix(), 10)
    }
    return secret
}
```

**é—®é¢˜åˆ†æ**:
1. `import_crypto := "crypto/rand"` è¿™ä¸æ˜¯å¯¼å…¥è¯­å¥,æ˜¯å­—ç¬¦ä¸²èµ‹å€¼
2. æ³¨é‡Šè¯´è¦ç”¨crypto/randä½†å®é™…æ²¡æœ‰ç”¨
3. ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå¯†é’¥éå¸¸ä¸å®‰å…¨

**å®‰å…¨é£é™©**: âš ï¸ é«˜é£é™© - JWTå¯†é’¥å¯é¢„æµ‹,å¯èƒ½è¢«ç ´è§£

**å»ºè®®ä¿®å¤**:
```go
import (
    "crypto/rand"
    "encoding/base64"
)

func getAuthJWTSecret() string {
    secret := os.Getenv("AUTH_JWT_SECRET")
    if secret == "" {
        // ç”ŸæˆçœŸæ­£çš„éšæœºå¯†é’¥
        b := make([]byte, 32)
        if _, err := rand.Read(b); err != nil {
            log.Fatal("æ— æ³•ç”Ÿæˆéšæœºå¯†é’¥:", err)
        }
        secret = base64.StdEncoding.EncodeToString(b)
    }
    return secret
}
```

---

#### 2. deferé”™è¯¯å¤„ç†ç¼ºå¤± (éšæ€§é”™è¯¯)

**ä½ç½®**: å¤šä¸ªæ–‡ä»¶,åŒ…æ‹¬æ‰€æœ‰æ’ä»¶æ–‡ä»¶

**é—®é¢˜ä»£ç ç¤ºä¾‹**:
```go
// plugin/yiove/yiove.go:232
resp, err := p.doRequestWithRetry(req, client, maxRequestRetries)
if err != nil {
    return nil, fmt.Errorf("[%s] æœç´¢è¯·æ±‚å¤±è´¥: %w", p.Name(), err)
}
defer resp.Body.Close() // âŒ æ²¡æœ‰æ£€æŸ¥Close()çš„é”™è¯¯
```

**å½±å“**:
- å¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼
- æ— æ³•å‘ç°åº•å±‚I/Oé”™è¯¯

**å»ºè®®**:
```go
defer func() {
    if err := resp.Body.Close(); err != nil {
        log.Printf("å…³é—­å“åº”ä½“å¤±è´¥: %v", err)
    }
}()
```

**å‡ºç°ä½ç½®**: çº¦50+å¤„

---

#### 3. æ½œåœ¨çš„å¹¶å‘å®‰å…¨é—®é¢˜

**ä½ç½®**: `service/search_service.go:1457-1460`

**é—®é¢˜ä»£ç **:
```go
var (
    pluginLevelCache = sync.Map{} // æ’ä»¶ç­‰çº§ç¼“å­˜
)
```

**é—®é¢˜**: sync.Mapä½¿ç”¨æ­£ç¡®,ä½†ç¼ºå°‘æ¸…ç†æœºåˆ¶,å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

---

#### 4. æ•°ç»„è¶Šç•Œé£é™© (éšæ€§é”™è¯¯)

**ä½ç½®**: `plugin/yiove/yiove.go:582`

**é—®é¢˜ä»£ç **:
```go
func substring(text string, start, end int) string {
    if start < 0 {
        start = 0
    }
    if end > len(text) {
        end = len(text)
    }
    return text[start:end] // âŒ å¦‚æœstart > endä¼španic
}
```

**å»ºè®®**:
```go
func substring(text string, start, end int) string {
    if start < 0 {
        start = 0
    }
    if end > len(text) {
        end = len(text)
    }
    if start > end {
        start, end = end, start  // æˆ–è€…ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²
    }
    return text[start:end]
}
```

---

### ğŸŸ¡ ä¸€èˆ¬é—®é¢˜

#### 5. é”™è¯¯ä¿¡æ¯ä¸ä¸€è‡´

**ä½ç½®**: å¤šä¸ªæ’ä»¶æ–‡ä»¶

**é—®é¢˜**: ä¸åŒæ’ä»¶çš„é”™è¯¯æ¶ˆæ¯æ ¼å¼ä¸ç»Ÿä¸€
- æœ‰çš„ç”¨ä¸­æ–‡,æœ‰çš„ç”¨è‹±æ–‡
- æœ‰çš„åŒ…å«æ’ä»¶å,æœ‰çš„ä¸åŒ…å«

**å»ºè®®**: ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯æ ¼å¼

---

#### 6. ç±»å‹è½¬æ¢æœªæ£€æŸ¥

**ä½ç½®**: `plugin/plugin.go:406`

**é—®é¢˜ä»£ç **:
```go
cacheAccessCount.Store(key, count.(int) + 1) // ç±»å‹æ–­è¨€æ²¡æœ‰æ£€æŸ¥
```

**å»ºè®®**:
```go
if count, ok := count.(int); ok {
    cacheAccessCount.Store(key, count + 1)
}
```

---

## ä¸‰ã€é€»è¾‘é€šé¡ºæ€§å’Œä¼˜åŒ–ç©ºé—´

### ğŸ”´ ä¸¥é‡é—®é¢˜

#### 1. service/search_service.go é€»è¾‘è¿‡äºå¤æ‚

**ä½ç½®**: `service/search_service.go:988-1208` (mergeResultsByTypeå‡½æ•°)

**é—®é¢˜**:
- å•ä¸ªå‡½æ•°220è¡Œ,åŒ…å«å¤šå±‚åµŒå¥—å¾ªç¯
- èŒè´£ä¸æ¸…æ™°: åŒæ—¶å¤„ç†é“¾æ¥æå–ã€å»é‡ã€å…³é”®è¯è¿‡æ»¤ã€æ’åºç­‰
- éš¾ä»¥ç†è§£å’Œç»´æŠ¤

**å»ºè®®é‡æ„**:
```go
// æ‹†åˆ†ä¸ºå¤šä¸ªå­å‡½æ•°
func mergeResultsByType(...) model.MergedLinks {
    // 1. æå–é“¾æ¥æ ‡é¢˜æ˜ å°„
    linkTitleMap := extractLinkTitleMapping(results)

    // 2. å¤„ç†é“¾æ¥å¹¶å»é‡
    uniqueLinks := processAndDeduplicateLinks(results, linkTitleMap)

    // 3. è¿‡æ»¤é“¾æ¥
    filteredLinks := filterLinksByKeyword(uniqueLinks, keyword)

    // 4. æŒ‰ç±»å‹åˆ†ç»„
    return groupLinksByType(filteredLinks, cloudTypes)
}
```

---

#### 2. æ¡ä»¶åˆ¤æ–­é€»è¾‘å¯ä»¥ç®€åŒ–

**ä½ç½®**: `api/handler.go:172-187`

**å½“å‰ä»£ç **:
```go
if len(req.Channels) == 0 {
    req.Channels = config.AppConfig.DefaultChannels
}

if req.ResultType == "" {
    req.ResultType = "merged_by_type"
} else if req.ResultType == "merge" {
    req.ResultType = "merged_by_type"
}

if req.SourceType == "" {
    req.SourceType = "all"
}
```

**ä¼˜åŒ–å»ºè®®**:
```go
// ä½¿ç”¨è¾…åŠ©å‡½æ•°ç®€åŒ–
func setDefaultIfEmpty(value *string, defaultValue string) {
    if *value == "" || *value == "merge" {
        *value = defaultValue
    }
}

// æˆ–è€…åœ¨modelå±‚æ·»åŠ é»˜è®¤å€¼å¤„ç†
```

---

#### 3. å¾ªç¯å†…éƒ¨çš„é‡å¤è®¡ç®—

**ä½ç½®**: `service/search_service.go:999-1145`

**é—®é¢˜**:
æ¯æ¬¡å¾ªç¯éƒ½é‡å¤æ‰§è¡Œç›¸åŒçš„å­—ç¬¦ä¸²è½¬æ¢:
```go
for _, result := range results {
    lowerKeyword := strings.ToLower(keyword) // âŒ åº”è¯¥åœ¨å¾ªç¯å¤–
    // ...
}
```

**å»ºè®®**: å°†ä¸å˜çš„è®¡ç®—ç§»åˆ°å¾ªç¯å¤–

---

### ğŸŸ¡ ä¸€èˆ¬ä¼˜åŒ–

#### 4. å¯ä»¥ä½¿ç”¨switchç®€åŒ–å¤šé‡if-else

**ä½ç½®**: `service/search_service.go:1518-1530`

**å½“å‰ä»£ç **:
```go
switch level {
case 1:
    return 1000
case 2:
    return 500
case 3:
    return 0
case 4:
    return -200
default:
    return 0
}
```
è¿™ä¸ªå·²ç»ç”¨switchäº†,å¾ˆå¥½

---

#### 5. å­—ç¬¦ä¸²æ‹¼æ¥æ•ˆç‡é—®é¢˜

**ä½ç½®**: `plugin/yiove/yiove.go:546-557`

**å½“å‰ä»£ç **:
```go
var builder strings.Builder
for _, b := range []byte(keyword) {
    builder.WriteByte('_')
    builder.WriteString(strings.ToUpper(fmt.Sprintf("%02x", b)))
}
```

**ä¼˜åŒ–**: fmt.Sprintfå¯ä»¥ä¼˜åŒ–ä¸ºç›´æ¥æ ¼å¼åŒ–

---

#### 6. å¹¶å‘æ§åˆ¶å¯ä»¥ä¼˜åŒ–

**ä½ç½®**: æ‰€æœ‰æ’ä»¶çš„å¹¶å‘workerå®ç°

**å½“å‰**: ä½¿ç”¨channelä¿¡å·é‡
```go
sem := make(chan struct{}, detailWorkers)
```

**å»ºè®®**: å¯ä»¥è€ƒè™‘ä½¿ç”¨ `golang.org/x/sync/semaphore` æˆ– `errgroup`

---

## å››ã€æ¨¡å—åŒ–å’Œè€¦åˆåº¦

### ğŸ”´ ä¸¥é‡é—®é¢˜

#### 1. plugin.goèŒè´£ä¸æ˜ç¡®,è€¦åˆåº¦é«˜

**ä½ç½®**: `plugin/plugin.go` (1169è¡Œ)

**é—®é¢˜åˆ†æ**:
å•ä¸ªæ–‡ä»¶åŒ…å«è¿‡å¤šèŒè´£:

```
plugin.go (1169è¡Œ)
â”œâ”€â”€ ç¬¬ä¸€éƒ¨åˆ†: æ¥å£å®šä¹‰ (1-63è¡Œ)
â”œâ”€â”€ ç¬¬äºŒéƒ¨åˆ†: å…¨å±€å˜é‡å’Œæ³¨å†Œè¡¨ (65-106è¡Œ)
â”œâ”€â”€ ç¬¬ä¸‰éƒ¨åˆ†: æ’ä»¶æ³¨å†Œå’Œç®¡ç† (108-231è¡Œ)
â”œâ”€â”€ ç¬¬å››éƒ¨åˆ†: å·¥å…·å‡½æ•° (233-273è¡Œ)
â”œâ”€â”€ ç¬¬äº”éƒ¨åˆ†: å¼‚æ­¥æ’ä»¶åŸºç¡€è®¾æ–½ (275-413è¡Œ)
â”œâ”€â”€ ç¬¬å…­éƒ¨åˆ†: BaseAsyncPluginç»“æ„ (415-534è¡Œ)
â”œâ”€â”€ ç¬¬ä¸ƒéƒ¨åˆ†: æ¥å£å®ç° (536-540è¡Œ)
â”œâ”€â”€ ç¬¬å…«éƒ¨åˆ†: å¼‚æ­¥æœç´¢æ ¸å¿ƒé€»è¾‘ (542-1019è¡Œ)
â”œâ”€â”€ ç¬¬ä¹éƒ¨åˆ†: ç¼“å­˜ç®¡ç† (1021-1148è¡Œ)
â””â”€â”€ ç¬¬åéƒ¨åˆ†: åºåˆ—åŒ–å™¨ (1150-1169è¡Œ)
```

**è€¦åˆé—®é¢˜**:
- æ’ä»¶æ¥å£ä¸å¼‚æ­¥å®ç°å¼ºè€¦åˆ
- ç¼“å­˜é€»è¾‘ä¸æ’ä»¶é€»è¾‘æ··åˆ
- å…¨å±€å˜é‡ç®¡ç†ä¸ä¸šåŠ¡é€»è¾‘æ··åˆ

**å»ºè®®æ‹†åˆ†**:
```
plugin/
â”œâ”€â”€ interface.go          # æ’ä»¶æ¥å£å®šä¹‰
â”œâ”€â”€ registry.go           # å…¨å±€æ³¨å†Œè¡¨
â”œâ”€â”€ manager.go            # æ’ä»¶ç®¡ç†å™¨
â”œâ”€â”€ base_async.go         # åŸºç¡€å¼‚æ­¥æ’ä»¶
â”œâ”€â”€ async_search.go       # å¼‚æ­¥æœç´¢é€»è¾‘
â”œâ”€â”€ cache.go              # æ’ä»¶ç¼“å­˜ç®¡ç†
â””â”€â”€ utils.go              # å·¥å…·å‡½æ•°
```

---

#### 2. search_service.goæ–‡ä»¶è¿‡å¤§

**ä½ç½®**: `service/search_service.go` (1560è¡Œ)

**é—®é¢˜**:
- åŒ…å«æœç´¢ã€è¿‡æ»¤ã€æ’åºã€åˆå¹¶ç­‰å¤šä¸ªèŒè´£
- éš¾ä»¥å®šä½å’Œä¿®æ”¹ç‰¹å®šåŠŸèƒ½

**å»ºè®®æ‹†åˆ†**:
```
service/
â”œâ”€â”€ search_service.go      # æ ¸å¿ƒæœç´¢æœåŠ¡ (400è¡Œ)
â”œâ”€â”€ result_merger.go       # ç»“æœåˆå¹¶é€»è¾‘ (300è¡Œ)
â”œâ”€â”€ result_filter.go       # ç»“æœè¿‡æ»¤é€»è¾‘ (200è¡Œ)
â”œâ”€â”€ result_ranker.go       # ç»“æœæ’åºé€»è¾‘ (300è¡Œ)
â””â”€â”€ link_extractor.go      # é“¾æ¥æå–é€»è¾‘ (300è¡Œ)
```

---

#### 3. æ’ä»¶ä¸ä¸»ç¨‹åºè€¦åˆè¿‡ç´§

**ä½ç½®**: `service/search_service.go:232-348`

**é—®é¢˜**:
- ä¸»ç¨‹åºéœ€è¦çŸ¥é“æ’ä»¶çš„å†…éƒ¨å®ç°ç»†èŠ‚
- `injectMainCacheToAsyncPlugins` å‡½æ•°è€¦åˆåº¦é«˜
- ç¼“å­˜æ›´æ–°é€»è¾‘åœ¨ä¸»ç¨‹åºä¸­å®ç°

**å»ºè®®**:
- ä½¿ç”¨ä¾èµ–æ³¨å…¥
- å®šä¹‰æ¸…æ™°çš„æ¥å£è¾¹ç•Œ
- æ’ä»¶é€šè¿‡æ¥å£ä¸ä¸»ç¨‹åºäº¤äº’

---

### ğŸŸ¡ ä¸€èˆ¬é—®é¢˜

#### 4. æ¨¡å‹å±‚èŒè´£ä¸æ¸…

**ä½ç½®**: `model/` åŒ…

**å»ºè®®**:
- åŒºåˆ†è¯·æ±‚æ¨¡å‹ã€å“åº”æ¨¡å‹ã€é¢†åŸŸæ¨¡å‹
- é¿å…åœ¨æ¨¡å‹å±‚åŒ…å«ä¸šåŠ¡é€»è¾‘

---

## äº”ã€ä»£ç é›†ä¸­åº¦å’Œæ‹†åˆ†å»ºè®®

### ğŸ”´ éœ€è¦ç«‹å³æ‹†åˆ†

#### 1. plugin/plugin.go (1169è¡Œ)

**å½“å‰**: å•æ–‡ä»¶1169è¡Œ
**å»ºè®®**: æ‹†åˆ†ä¸º7ä¸ªæ–‡ä»¶(è§ä¸Šæ–‡"æ¨¡å—åŒ–"éƒ¨åˆ†)
**ä¼˜å…ˆçº§**: â­â­â­â­â­

---

#### 2. service/search_service.go (1560è¡Œ)

**å½“å‰**: å•æ–‡ä»¶1560è¡Œ
**å»ºè®®**: æ‹†åˆ†ä¸º5ä¸ªæ–‡ä»¶(è§ä¸Šæ–‡)
**ä¼˜å…ˆçº§**: â­â­â­â­â­

---

### ğŸŸ¡ å»ºè®®æ‹†åˆ†

#### 3. æ’ä»¶å…¬å…±ä»£ç æå–

**å½“å‰**: æ¯ä¸ªæ’ä»¶æ–‡ä»¶400-600è¡Œ,å¤§é‡é‡å¤
**å»ºè®®**:
```
util/
â”œâ”€â”€ plugin_common.go      # å…¬å…±å·¥å…·å‡½æ•°
â”œâ”€â”€ link_patterns.go      # é“¾æ¥æ¨¡å¼å®šä¹‰
â”œâ”€â”€ http_helper.go        # HTTPå·¥å…·
â””â”€â”€ password_extractor.go # å¯†ç æå–
```
**ä¼˜å…ˆçº§**: â­â­â­â­

---

#### 4. main.goç®€åŒ–

**å½“å‰**: main.goåŒ…å«å¤§é‡å¯¼å…¥å’Œåˆå§‹åŒ–é€»è¾‘
**å»ºè®®**:
```go
// main.go - åªä¿ç•™å¯åŠ¨é€»è¾‘
func main() {
    app.Run()
}

// app/app.go - åº”ç”¨é€»è¾‘
func Run() {
    initApp()
    startServer()
}
```
**ä¼˜å…ˆçº§**: â­â­â­

---

## å…­ã€å…¶ä»–å‘ç°

### âœ… åšå¾—å¥½çš„åœ°æ–¹

1. **æ¥å£è®¾è®¡è‰¯å¥½**: pluginåŒ…çš„æ¥å£è®¾è®¡æ¸…æ™°,æ‰©å±•æ€§å¼º
2. **å¹¶å‘å¤„ç†**: ä½¿ç”¨äº†åˆç†çš„å¹¶å‘æ¨¡å¼(worker pool, semaphore)
3. **ç¼“å­˜ç­–ç•¥**: ä¸¤çº§ç¼“å­˜è®¾è®¡åˆç†
4. **é”™è¯¯å¤„ç†**: å¤§éƒ¨åˆ†åœ°æ–¹æœ‰é€‚å½“çš„é”™è¯¯åŒ…è£…
5. **é…ç½®ç®¡ç†**: ç¯å¢ƒå˜é‡é…ç½®çµæ´»

---

### ğŸ“Š ä»£ç ç»Ÿè®¡

```
æ–‡ä»¶ç±»å‹          æ–‡ä»¶æ•°    æ€»è¡Œæ•°    å¹³å‡è¡Œæ•°
main.go           1        404       404
config/           1        600       600
api/              5        ~800      160
service/          2        ~2200     1100
plugin/plugin.go  1        1169      1169
plugin/æ’ä»¶       75       ~30000    400
util/             11       ~2000     180
model/            3        ~200      67
----------------------------------------------
æ€»è®¡              99       ~37000    374
```

---

## ä¸ƒã€ä¼˜å…ˆçº§å»ºè®®

### ğŸ”¥ ç«‹å³ä¿®å¤ (P0)

1. **config.go:577-586** JWTå¯†é’¥ç”Ÿæˆé”™è¯¯ â†’ å®‰å…¨é£é™©
2. **substringå‡½æ•°** æ•°ç»„è¶Šç•Œé£é™© â†’ å¯èƒ½panic

### âš¡ é«˜ä¼˜å…ˆçº§ (P1)

1. **æ’ä»¶ä»£ç é‡å¤** â†’ æå–å…¬å…±ä»£ç åˆ°utilåŒ…
2. **plugin.goæ‹†åˆ†** â†’ æé«˜å¯ç»´æŠ¤æ€§
3. **search_service.goæ‹†åˆ†** â†’ é™ä½å¤æ‚åº¦

### ğŸ“ ä¸­ä¼˜å…ˆçº§ (P2)

1. **main.goæ’ä»¶å¯¼å…¥** â†’ è‡ªåŠ¨åŒ–å¯¼å…¥
2. **deferé”™è¯¯å¤„ç†** â†’ æ·»åŠ é”™è¯¯æ£€æŸ¥
3. **æ—¥å¿—è¾“å‡ºç»Ÿä¸€** â†’ å°è£…å·¥å…·å‡½æ•°

### ğŸ’¡ ä½ä¼˜å…ˆçº§ (P3)

1. æ€§èƒ½ä¼˜åŒ–(å­—ç¬¦ä¸²æ‹¼æ¥ã€å¾ªç¯å†…è®¡ç®—ç­‰)
2. ä»£ç é£æ ¼ç»Ÿä¸€
3. æ³¨é‡Šè¡¥å……

---

## å…«ã€é‡æ„å»ºè®®è·¯çº¿å›¾

### é˜¶æ®µ1: å®‰å…¨ä¿®å¤ (1-2å¤©)
- [ ] ä¿®å¤JWTå¯†é’¥ç”Ÿæˆ
- [ ] ä¿®å¤substringå‡½æ•°è¶Šç•Œ
- [ ] æ·»åŠ deferé”™è¯¯å¤„ç†

### é˜¶æ®µ2: ä»£ç å»é‡ (3-5å¤©)
- [ ] æå–æ’ä»¶å…¬å…±ä»£ç åˆ°utilåŒ…
- [ ] ç»Ÿä¸€æ­£åˆ™è¡¨è¾¾å¼ç®¡ç†
- [ ] ç»Ÿä¸€HTTPå·¥å…·

### é˜¶æ®µ3: æ–‡ä»¶æ‹†åˆ† (5-7å¤©)
- [ ] æ‹†åˆ†plugin.go
- [ ] æ‹†åˆ†search_service.go
- [ ] é‡ç»„ç›®å½•ç»“æ„

### é˜¶æ®µ4: ä¼˜åŒ–é‡æ„ (7-10å¤©)
- [ ] ç®€åŒ–main.goå¯¼å…¥
- [ ] ä¼˜åŒ–é€»è¾‘å¤æ‚åº¦
- [ ] æ€§èƒ½ä¼˜åŒ–

### é˜¶æ®µ5: æµ‹è¯•å’ŒéªŒè¯ (3-5å¤©)
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

---

## ä¹ã€å»ºè®®çš„æ–°ç›®å½•ç»“æ„

```
pansou/
â”œâ”€â”€ main.go                    # ç®€åŒ–åçš„å…¥å£ (~50è¡Œ)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.go                 # åº”ç”¨å¯åŠ¨é€»è¾‘
â”‚   â””â”€â”€ init.go                # åˆå§‹åŒ–é€»è¾‘
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ handler.go             # APIå¤„ç†å™¨
â”‚   â”œâ”€â”€ router.go              # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ middleware.go          # ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth_handler.go        # è®¤è¯å¤„ç†
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.go              # é…ç½®ç®¡ç†
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ request.go             # è¯·æ±‚æ¨¡å‹
â”‚   â”œâ”€â”€ response.go            # å“åº”æ¨¡å‹
â”‚   â””â”€â”€ plugin_result.go       # æ’ä»¶ç»“æœ
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ search_service.go      # æ ¸å¿ƒæœç´¢ (~400è¡Œ)
â”‚   â”œâ”€â”€ result_merger.go       # ç»“æœåˆå¹¶ (~300è¡Œ)
â”‚   â”œâ”€â”€ result_filter.go       # ç»“æœè¿‡æ»¤ (~200è¡Œ)
â”‚   â”œâ”€â”€ result_ranker.go       # ç»“æœæ’åº (~300è¡Œ)
â”‚   â””â”€â”€ link_extractor.go      # é“¾æ¥æå– (~300è¡Œ)
â”œâ”€â”€ plugin/
â”‚   â”œâ”€â”€ interface.go           # æ’ä»¶æ¥å£ (~100è¡Œ)
â”‚   â”œâ”€â”€ registry.go            # æ³¨å†Œè¡¨ (~150è¡Œ)
â”‚   â”œâ”€â”€ manager.go             # ç®¡ç†å™¨ (~200è¡Œ)
â”‚   â”œâ”€â”€ base_async.go          # å¼‚æ­¥åŸºç±» (~300è¡Œ)
â”‚   â”œâ”€â”€ async_search.go        # å¼‚æ­¥æœç´¢ (~400è¡Œ)
â”‚   â”œâ”€â”€ cache.go               # ç¼“å­˜ç®¡ç† (~200è¡Œ)
â”‚   â”œâ”€â”€ utils.go               # å·¥å…·å‡½æ•° (~100è¡Œ)
â”‚   â”œâ”€â”€ all.go                 # ç»Ÿä¸€å¯¼å…¥æ‰€æœ‰æ’ä»¶
â”‚   â”œâ”€â”€ yiove/
â”‚   â”‚   â””â”€â”€ yiove.go           # ç®€åŒ–å (~200è¡Œ)
â”‚   â”œâ”€â”€ lou1/
â”‚   â”‚   â””â”€â”€ lou1.go            # ç®€åŒ–å (~200è¡Œ)
â”‚   â””â”€â”€ ... (å…¶ä»–æ’ä»¶)
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ http_util.go           # HTTPå·¥å…·
â”‚   â”œâ”€â”€ plugin_common.go       # æ’ä»¶å…¬å…±ä»£ç  (æ–°å¢)
â”‚   â”œâ”€â”€ link_patterns.go       # é“¾æ¥æ¨¡å¼ (æ–°å¢)
â”‚   â”œâ”€â”€ password_extractor.go  # å¯†ç æå– (æ–°å¢)
â”‚   â”œâ”€â”€ http_helper.go         # HTTPè¾…åŠ© (æ–°å¢)
â”‚   â””â”€â”€ ... (å…¶ä»–å·¥å…·)
â””â”€â”€ util/cache/
    â””â”€â”€ ... (ç¼“å­˜ç›¸å…³)
```

---

## åã€æ€»ç»“

### ä¸»è¦é—®é¢˜æ±‡æ€»

1. **ä»£ç é‡å¤**: ä¼°è®¡3000+è¡Œé‡å¤ä»£ç ,ä¸»è¦åœ¨æ’ä»¶ä¸­
2. **æ–‡ä»¶è¿‡å¤§**: plugin.go(1169è¡Œ)ã€search_service.go(1560è¡Œ)éœ€è¦æ‹†åˆ†
3. **å®‰å…¨é—®é¢˜**: JWTå¯†é’¥ç”Ÿæˆå­˜åœ¨ä¸¥é‡ç¼ºé™·
4. **ç»´æŠ¤æ€§å·®**: æ‰‹åŠ¨ç®¡ç†75ä¸ªæ’ä»¶å¯¼å…¥,å®¹æ˜“å‡ºé”™

### æ•´ä½“è¯„ä»·

**ä¼˜ç‚¹**:
- âœ… æ¶æ„è®¾è®¡åˆç†,æ¥å£æ¸…æ™°
- âœ… å¹¶å‘å¤„ç†å¾—å½“
- âœ… ç¼“å­˜ç­–ç•¥å®Œå–„

**ç¼ºç‚¹**:
- âŒ ä»£ç é‡å¤ç‡é«˜
- âŒ æ–‡ä»¶è¿‡äºé›†ä¸­
- âŒ å­˜åœ¨å®‰å…¨éšæ‚£
- âŒ ç»´æŠ¤æˆæœ¬é«˜

### å»ºè®®

**çŸ­æœŸ** (1-2å‘¨):
1. ä¿®å¤å®‰å…¨é—®é¢˜
2. æå–å…¬å…±ä»£ç 
3. æ‹†åˆ†å¤§æ–‡ä»¶

**ä¸­æœŸ** (1-2æœˆ):
1. é‡æ„å¤æ‚é€»è¾‘
2. ä¼˜åŒ–æ€§èƒ½
3. å®Œå–„æµ‹è¯•

**é•¿æœŸ** (3-6æœˆ):
1. å»ºç«‹ä»£ç è§„èŒƒ
2. è‡ªåŠ¨åŒ–å·¥å…·
3. æŒç»­é‡æ„

---

**å®¡æŸ¥äºº**: Claude
**å®¡æŸ¥å·¥å…·**: äººå·¥ä»£ç å®¡æŸ¥
**ç½®ä¿¡åº¦**: é«˜ (åŸºäºå¯¹100+ä¸ªGoæ–‡ä»¶çš„æ·±åº¦åˆ†æ)